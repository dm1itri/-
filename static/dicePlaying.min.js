const diceId=["dicePlaying1","dicePlaying2","dicePlaying3","dicePlaying4","dicePlaying5","dicePlaying6"],questionCards=[1,2,3,4,5,6,8,10,11,13,14,15,16,17,18,20,22,23],questionBiologyCards=[2,10,14,17,22],questionHistoryCards=[1,5,11,18,23],questionGeographyCards=[4,6,8,13,16,20],rusNamePlayers=["желтый","зеленый","красный","синий"],enNamePlayers=["yellow","green","red","blue"],baseURL="http://localhost:8001";let answerCorrect,currentPlayer,numberHistory,playersCoords=[],thisPlayer=Number(document.cookie.match(/number_move=(.+?)(;|$)/)[1]);function getPlayersStatics(){fetch(`${baseURL}/api/players_statics`).then(e=>e.json()).then(e=>{for(let t=0;t<Object.keys(e).length;t++)document.getElementById(`${t}Player`).style.display="block",document.getElementById(`${t}numberOfMoves`).innerText=e[t].numbers_of_moves,document.getElementById(`${t}numberOfPoints`).innerText=e[t].number_of_points,document.getElementById(`${t}numberOfQuestionsReceived`).innerText=e[t].number_of_questions_received,document.getElementById(`${t}percentOfCorrectAnswers`).innerText=e[t].percent_of_correct_answers})}function getCurrentPlayer(){let e,t=new XMLHttpRequest;return t.onreadystatechange=function(){t.readyState===XMLHttpRequest.DONE&&(200===t.status?e=JSON.parse(t.response):console.log(t.status))},t.open("GET",`${baseURL}/api/game`,!1),t.send(),e}function putCurrentPLayer(e,t,n,r,o){let s=new FormData;s.append("current_player",t),s.append("current_position",n),s.append("skipping_move",e),s.append("number_of_points",r),s.append("thinks_about_the_question",o);let a=new XMLHttpRequest;a.onreadystatechange=function(){a.readyState===XMLHttpRequest.DONE&&200!==a.status&&console.log(a.status)},a.open("PUT",`${baseURL}/api/game`,!1),a.send(s)}function putHistoryMove(e,t){let n=new FormData;n.append("number_move",e),n.append("number_steps",t);let r=new XMLHttpRequest;r.onreadystatechange=function(){r.readyState===XMLHttpRequest.DONE&&200!==r.status&&console.log(r.status)},r.open("PUT",`${baseURL}/api/history_game`,!1),r.send(n)}function getHistoryMove(e){let t,n=new XMLHttpRequest;return n.onreadystatechange=function(){t=n.readyState===XMLHttpRequest.DONE&&200===n.status?JSON.parse(n.response):null},n.open("GET",`${baseURL}/api/history_game?number_history=${e}`,!1),n.send(),t}function getQuestion(e=null,t=null){let n,r=new XMLHttpRequest;return r.onreadystatechange=function(){r.readyState===XMLHttpRequest.DONE&&(200===r.status?n=JSON.parse(r.response):console.log(r.status))},r.open("GET",`${baseURL}/api/question?type_question=${e}&question_id=${t}`,!1),r.send(),n}function getCurrentPlayers(){let e,t=new XMLHttpRequest;t.onreadystatechange=function(){t.readyState===XMLHttpRequest.DONE&&200===t.status&&(e=JSON.parse(t.response))},t.open("GET",`${baseURL}/api/players`,!1),t.send(),currentPlayer=e.current_player,numberHistory=e.number_history;for(let t=0;t<e.count_players;t++)playersCoords.push(e[`${t}_player`].current_position),document.getElementById(`${t}_Player`).style.display="block",0!==playersCoords[t]&&rollDice(t,0,playersCoords[t]);return null!==e.question_id&&currentPlayer===thisPlayer&&(answerCorrect=updateQuestion(getQuestion(null,e.question_id))),e[`${thisPlayer}_player`].thinks_about_the_question}const randomIntFromInterval=(e,t)=>Math.floor(Math.random()*(t-e+1)+e);function dicePlaying(){document.getElementById("buttonDicePlaying").style.visibility="hidden";let e,t,n=randomIntFromInterval(0,5);document.getElementById(diceId[n]).style.display="block",t=setInterval(function(){e=n,n=(n=randomIntFromInterval(0,5))===e?(n+1)%6:n,document.getElementById(diceId[n]).style.display="block",document.getElementById(diceId[e]).style.display="none"},100),setTimeout(()=>clearInterval(t),2e3),setTimeout(function(){document.getElementById(diceId[n]).style.display="none",move(currentPlayer,n+1)},3e3)}function rollDice(e,t,n){const r=[0,7,12,19];let o,s=t;t>=19?t-=19:t>=12?t-=12:t>=7&&(t-=7);for(let a=1;a<=n;a++)0<=s&&s<7?(o=e%2?6!==s?100*t+250:100*t+350:100*t+200,document.getElementById(`${e}_Player`).style.left=o+"px"):7<=s&&s<12?(o=e<2?100*t+200:11!==s?100*t+250:100*t+350,document.getElementById(`${e}_Player`).style.top=o+"px"):12<=s&&s<19?(o=e%2?750-100*t:18!==s?700-100*t:700-100*t-100,document.getElementById(`${e}_Player`).style.left=o+"px"):(o=e<2?23!==s?500-100*t:500-100*t-100:550-100*t,document.getElementById(`${e}_Player`).style.top=o+"px"),s=23===s?0:s+1,t=r.includes(s)?0:t+1;return s}function checkSquareCards(e){if(12===playersCoords[e]){let t=randomIntFromInterval(1,23);setTimeout(rollDice,1e3,e,playersCoords[e],t),putHistoryMove(currentPlayer,t),playersCoords[e]=(t+playersCoords[e])%24,numberHistory+=1}return 19===playersCoords[e]&&(setTimeout(rollDice,2e3,e,playersCoords[e],12),putHistoryMove(currentPlayer,12),playersCoords[e]=7,numberHistory+=1),7===playersCoords[e]?1:0}function sleep(e){return new Promise(t=>setTimeout(t,e))}function updateDocument(e,t=!1,n){document.getElementById("endGame").style.display=n?"block":"none",document.getElementById("question").style.display=n?"none":"block",document.getElementById("rollDice").style.display=n?"none":"block",document.getElementById("numberPlayer").innerText=rusNamePlayers[e],document.getElementById("numberPlayer").style.color=enNamePlayers[e],document.getElementById("buttonDicePlaying").style.visibility=e!==thisPlayer||t?"hidden":"visible"}function updateQuestion(e){const t=randomIntFromInterval(1,4);document.getElementById("question_1").innerText=e.question;for(let t=2;t<5;t++)document.getElementById(`btn_answer_${t}`).value=e[`answer_${t}`];return 1!==t&&(document.getElementById("btn_answer_1").value=e[`answer_${t}`]),document.getElementById(`btn_answer_${t}`).value=e.answer_correct,document.getElementById("question").style.visibility="visible",t}async function choosingAnswer(e){let t=1;document.getElementById(`btn_answer_${answerCorrect}`).style.background="rgba(0,255,0,0.71)",e!==answerCorrect&&(t=0,document.getElementById(`btn_answer_${e}`).style.background="rgba(255,0,0,0.89)"),setTimeout(function(){document.getElementById(`btn_answer_${answerCorrect}`).style.background="buttonface",document.getElementById(`btn_answer_${e}`).style.background="buttonface",document.getElementById("question").style.visibility="hidden"},3e3),await endMoveAndAnswer(currentPlayer,7===playersCoords[currentPlayer]?1:0,playersCoords[currentPlayer],t,0)}async function move(e,t){let n;putHistoryMove(e,t),numberHistory+=1,playersCoords[e]=rollDice(e,playersCoords[e],t);let r=checkSquareCards(e);if(0===r&&questionCards.includes(playersCoords[e]))endMoveAndAnswer(e,r,playersCoords[e],0,1),n=questionBiologyCards.includes(playersCoords[e])?getQuestion("Биология"):questionHistoryCards.includes(playersCoords[e])?getQuestion("История"):questionGeographyCards.includes(playersCoords[e])?getQuestion("География"):getQuestion("Случайный"),answerCorrect=updateQuestion(n);else{let t=21===playersCoords[e]?1:9===playersCoords[e]?-1:0;endMoveAndAnswer(e,r,playersCoords[e],t,0)}}async function endMoveAndAnswer(e,t,n,r,o){putCurrentPLayer(t,e,n,r,o),o||await waiting_move()}async function waiting_move(){let e,t,n,r=!0;for(;r;)getPlayersStatics(),!1===(t=getCurrentPlayer()).game.is_over?(currentPlayer=t.game.current_player,n=getHistoryMove(numberHistory+1),updateDocument(currentPlayer,t.thinks_about_the_question&&currentPlayer===thisPlayer,!1),currentPlayer===thisPlayer&&null===n?r=!1:null===n?await sleep(1e3):(e=n.number_move,playersCoords[e]=rollDice(e,playersCoords[e],n.number_steps),numberHistory+=1,await sleep(2e3))):(setTimeout(updateDocument,1e3,currentPlayer,!1,!0),r=!1)}getCurrentPlayers(),waiting_move();